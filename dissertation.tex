\documentclass[12pt]{ucsddissertation}
% mathptmx is a Times Roman look-alike (don't use the times package)
% It isn't clear if Times is required. The OGS manual lists several
% "standard fonts" but never says they need to be used.
\usepackage{mathptmx}
\usepackage[NoDate]{currvita}
\usepackage{array}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{ragged2e}
\usepackage{microtype}
\usepackage[breaklinks=true,pdfborder={0 0 0}]{hyperref}
\usepackage{graphicx}
\AtBeginDocument{%
	\settowidth\cvlabelwidth{\cvlabelfont 0000--0000}%
}

% OGS recommends increasing the margins slightly.
\increasemargins{.1in}

% These are just for testing/examples, delete them
\usepackage{trace}
%\usepackage{showframe} % This package was just to see page margins
\usepackage[english]{babel}
\overfullrule5pt
% ---

% Packages specific to this dissertation
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{contour}
%\usepackage{amsthm}
\usepackage{xcolor}
\usepackage{bussproofs}
\usepackage{listings}
\usepackage{hyperref}
\usepackage{tabularx}
\usepackage{tikz}
\usepackage{macros}
\usepackage{xspace}
\usepackage{adjustbox}
%\usepackage{gensymb}
%\usepackage{pgfplots}
\usepackage{etex}
\usepackage{todonotes}
\usepackage{mfirstuc}
\usepackage{changebar}
\usepackage{subcaption}
\usepackage{enumitem}

\usetikzlibrary{calc}
\usetikzlibrary{backgrounds}
\usetikzlibrary{patterns}
\usetikzlibrary{decorations}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations.markings}
\usetikzlibrary{positioning}

\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{definition}{Definition}

% Required information
\title{Verification of Sampled-Data Systems using Coq}
\author{Daniel Ricketts}
\degree{Computer Science}{Doctor of Philosophy}
% Each member of the committee should be listed as Professor Foo Bar.
% If Professor is not the correct title for one, then titles should be
% omitted entirely.
\chair{Professor Sorin Lerner}
% Your committee members (other than the chairs) must be in alphabetical order
\committee{Professor Samuel Buss}
\committee{Professor William Griswold}
\committee{Professor Ranjit Jhala}
\committee{Professor Todd Millstein}
\degreeyear{2017}

% Start the document
\begin{document}
% Begin with frontmatter and so forth
\frontmatter
\maketitle
\makecopyright
\makesignature
% Optional
\begin{dedication}
\setsinglespacing
\raggedright % It would be better to use \RaggedRight from ragged2e
\parindent0pt\parskip\baselineskip
In recognition of reading this manual before beginning to format the
doctoral dissertation or master's thesis; for following the
instructions written herein; for consulting with OGS Academic Affairs
Advisers; and for not relying on other completed manuscripts, this
manual is dedicated to all graduate students about to complete the
doctoral dissertation or master's thesis.

In recognition that this is my one chance to use whichever
justification, spacing, writing style, text size, and/or textfont that
I want to while still keeping my headings and margins consistent.
\end{dedication}
% Optional
\begin{epigraph}
\vskip0pt plus.5fil
\setsinglespacing
{\flushright
True ease in writing comes from art, not chance,\\
As those move easiest who have learn'd to dance.\\
'T is not enough to no harshness gives offence,---\\
The sound must seem an echo to the sense.

\vskip\baselineskip
\textit{Alexander Pope}\par}
\vfil
\begin{center}
You write with ease to show your breeding,\\
But easy writing's curst hard reading.

\vskip\baselineskip
\textit{Richard Brinsley Sheridan}
\end{center}
\vfil
\noindent Writing, at its best, is a lonely life. Organizations for
writers palliate the writer's loneliness, but I doubt if they improve
his writing. He grows in public stature as he sheds his loneliness and
often his work deteriorates. For he does his work alone and if he is a
good enough writer he must face eternity, or the lack of it, each day.

\vskip\baselineskip
\hskip0pt plus1fil\textit{Ernest Hemingway}\hskip0pt plus4fil\null

\vfil
\end{epigraph}

% Next comes the table of contents, list of figures, list of tables,
% etc. If you have code listings, you can use \listoflistings (or
% \lstlistoflistings) to have it be produced here as well. Same with
% \listofalgorithms.
\tableofcontents
\listoffigures
\listoftables

% Preface
\begin{preface}
Almost nothing is said in the manual about the preface. There is no
indication about how it is to be typeset. Given that, one is forced to
simply typeset it and hope it is accepted. It is, however, optional
and may be omitted.
\end{preface}

% Your fancy acks here. Keep in mind you need to ack each paper you
% use. See the examples here. In addition, each chapter ack needs to
% be repeated at the end of the relevant chapter.
\begin{acknowledgements}
I would like to acknowledge Professor Eta Theta for his support as the
chair of my committee. Through multiple drafts and many long nights,
his guidance has proved to be invaluable.

I would also like to acknowledge the ``Smith Clan'' of lab~28, without
whom my research would have no doubt taken fives times as long. It is
their support that helped me in an immeasureable way.

Chapter 2, in full, is a reprint of the material as it appears in
Numerical Grid Generational in Computational Fluid Mechanics~2009.
Smith, Laura; Smith, Jane~D., Pineridge Press,~2009. The dissertation
author was the primary investigator and author of this paper.

Chapter 3, in part, has been submitted for publication of the material
as it may appear in Education Mechanics,~2009, Smith, Laura; Smith,
Jane~D., Trailor Press,~2009. The dissertation author was the primary
investigator and author of this paper.

Chapter 5, in part is currently being prepared for submission for
publication of the material. Smith, Laura; Smith, Jane~D\@. The
dissertation author was the primary investigator and author of this
material.
\end{acknowledgements}

% Stupid vita goes next
\begin{vita}
\noindent
\begin{cv}{}
\begin{cvlist}{}
\item[1996] Bachelor of Arts, University of California, Berkeley
\item[1996--2000] U.S. Marines
\item[2000--2002] Teaching Assistant, Department of Mechanical
Engineering\\University of California, San Diego
\item[2002--2006] Research Assistant, University of California, San
Diego
\item[2010] Doctor of Philosophy, University of California, San Diego
\end{cvlist}
\end{cv}

% This puts in the PUBLICATIONS header. Note that it appears inside
% the vita environment. It is optional.
\publications
\noindent``Distributions of Control Points in a System for Analysis of Stress
Distribution'' IRE Transactions of the I.R.E\@. Professional Group on
Automatic Control, vol. AC-7, pp 272--289, September 2005

% This puts in the FIELDS OF STUDY. Also inside vita and also
% optional.
\fieldsofstudy
\noindent Major Field: Engineering (Specialization or Focused Studies)
\vskip\baselineskip
Studies in Applied Mathematics\par
Professors Alpha Beta and Gamma Delta
\vskip\baselineskip
Studies in Mechanices\par
Professors Epsilon Zeta and Eta Theta
\vskip\baselineskip
Studies in Electromagnetism\par
Professors Iota Kappa and Lambda Mu
\end{vita}

% Put your maximum 350 word abstract here.
\begin{dissertationabstract}
The Abstract begins here. The abstract is limited to 350 words for a
doctoral dissertation. It should consist of a short statement of the
problem, a brief explanation of the methods and procedures employed in
generating the data, and a condensed summary of the findings of the
study. The abstract may continute onto a second page if necessary. The
text of the abstract must be double spaced.
\end{dissertationabstract}

% This is where the main body of your dissertation goes!
\mainmatter

% Optional Introduction
\begin{dissertationintroduction}
Errors in cyber-physical systems (CPS) can lead to disastrous consequences,
including loss of life.  These consequences mean that such systems demand
the most rigorous verification techniques.  There has been a variety of
work on developing fully-automated tools for verification of cyber-physical
systems~\cite{PHAVerSTTT08,HyTechCAV97}, but due to the complexity of the
domain, these tools are only able to verify particular classes of systems
and properties.  On the other hand, all cyber-physical systems are in range
for deductive verification in a proof assistant, at least in theory.  In
this technique, a user writes a formal model of a system in the language of
the proof assistant and then interactively proves it correct. However, one
of the typically-stated drawbacks of verification in proof assistants is
the extremely high manual labor cost required to produce these proofs.

Mitigating this manual proof burden requires powerful higher-order proof
rules that capture common proof strategies. Prior work in deductive
verification has approached this task by designing general-purpose,
complete proof calculi for hybrid systems~\cite{platzer???,HHL???}. Hybrid
systems are CPS models comprised of both a discrete component (e.g. control
software) and a continuous component (the physical world). While powerful,
the generality of the proof calculi prevents them from leveraging
particular common characteristics of cyber-physical systems. For example,
no proof rule in~\cite{platzer??} assumes that the time between executions
of a controller is bounded because this is not true of all hybrid
systems. However, this is true of many realistic hybrid systems, and proofs
about such systems will tend to follow a similar proof structure. Thus, it
is beneficial to complement general hybrid system proof rules with domain
specific proof rules that capture common reasoning patterns.

This dissertation presents and applies a series of proof rules that capture
common reasoning patterns in the important domain of \emph{periodic
  sampled-data systems}~\cite{chen1995sampled}. In such a system, there is
a digital controller that runs periodically. In between executions of the
controller, the system evolves according to continuous physical
dynamics. Many modern cyber-physical systems fit into this domain. The
remainder of the introduction provides an overview of the proof rules. In
general, the rules seek to leverage timing characteristics of systems and
improve modularity of reasoning.

In \textbf{Chapter~\ref{chap:memo15}} we present two rules: one for
verifying a single sampled-data component under assumption on the
environment and another for composing such a component with another that
satisfies this assumption. The first rule decomposes verification into a
property of the discrete controller and the continuous dynamics,
automatically handling the fact that the time between executions of the
controller is bounded. This tailored decomposition eliminates some of the
basic tedious manipulation common to every sampled-data system, allowing
one to focus on the application specific aspects of verification. The
second proof rule allows for component composition with non-cylical
assumptions -- that is, a component $C1$ can guarantee an invariant $Q$
while assuming and invariant $P$ guaranteed by $C2$. However, $C2$ cannot
rely on the invariance of $P$ when guaranteeing $Q$. In spite of this
restriction, we show that such a rule has important applications for
verifying controllers in the presence of sensor error and delay.

Next, \textbf{Chapter~\ref{chap:emsoft16}} presents a general framework for
building sampled-data systems \emph{modularly}. This framework differs from
the above composition approach by requiring that each component provide a
stronger interface. In particular, rather than proving invariance of a
property, each component provides preservation of an inductive invariant,
and a notion of progress of the system under that inductive invariant. This
stronger interface comes at a minor cost while proving two important
benefits. First, it allows for cyclic dependencies between sampled-data
components, thus removing the restriction from
Chapter~\ref{chap:memo15}. Second, it allows us to explore a richer set of
operators for modularly building and verifying sampled-data components,
namely substitution, conjunction, and disjunction. It is this second
benefit that we explore thoroughly by applying our framework to build
verified 3-dimensional geofences for a UAV. We show that our theory can
handle the important situation in which different components output to the
same set of actuators, as exemplified by the geofence application.

Finally, in \textbf{Chapter~\ref{chap:exp-smpl}}, we revisit verification
of a single sampled-data system component. Contrary to our prior
approaches, we began by building a geofence that was good enough to be
adopted by the popular open source UAV autopilot called
Ardupilot~\cite{???}. After building such a module (now available in the
latest Ardupilot release), we attempted to formally verify a component of
it in Coq, particularly the logic that prevents the vehicle from violating
a boundary in a single spatial dimension. Similar logic is present in the
atomic components from Chapters~\ref{chap:memo15} and~\ref{chap:emsoft16},
but realistic performance requirements for Ardupilot resulted in
considerably more complicated control logic. This additional complexity
demanded better proof rules, and we built rules that improve upon the state
of the art in formal verification in two ways.

First, deductive techniques typically involve some continuous analogue of
induction, e.g. differential induction~\cite{Ghorbal14diffinv} or barrier
certificates~\cite{prajna04barrier}. Recent work from the control theory
community~\cite{kong2013barrier,xu15barrier,nguyen16barrier} has produced a
new version of barrier certificates that are less conservative for closed
properties. We provide the first implementation of this approach in a
formal verification context, and demonstrate its ease of use on a component
of the ardupilot geofencing module.

Second, control systems are often designed under the assumption that
controllers run continuously, while the actual implementation is typically
a sampled-data system. System designers can compensate for this (and other)
approximations by adding a safety ``buffer'' to the system. For example,
the ardupilot geofence module stops the vehicle 1 meter prior to the actual
safety boundary. We developed a proof rule that formalizes this design
approach by decomposing verification into a condition on the continuous
time approximation and another on the approximation error.  This rule
allows one to perform the majority of reasoning in a purely continuous
model using powerful techniques resulting from over a century of control
theory research.

As already mentioned, our running application in this work is a geofencing
controller for UAVs, an important application due to their potential safety
thread combined with widespread use by hobbyists and businesses alike. We
would like to ensure that the controller we build and verify are not toy
models. We have attempted to justify the realistic nature of our work by
flying the controllers we verify on an actual quadcopter. Throughout this
dissertation, we discuss lessons learned from this experience.

Rigorous verification requires that results be mechanically checked in some
way. Rather than implementing a standalone tool for this task, we performed
all verification within the foundational Coq proof assistant. Previous
work~\cite{yang2011understanding-compiler-bugs} has empirically
demonstrated that foundationally verified systems are highly
reliable. While important, we would like to emphasize a less discussed
benefit of higher-order proof assistants like Coq. A standalone domain
specific verification tool would require adding each proof rule as an
axiom. Moreover, a new proof rule might have side conditions not
expressible in the tool's logic, requiring custom reasoning to handle these
side conditions. In this context, the axiom and associated custom reasoning
have the potential to compromise soundness.

On the other hand, the \emph{expressiveness} of Coq allows one add new
proof rules as theorems that are formally proven within Coq's logic. This
means that one can extend any given set of general proof rules in Coq
(e.g. general proof calculi for hybrid systems) with powerful domain
specific proof rules (e.g. our sampled-data system rules), without
compromising soundness. Such an extension improves verification
productivity by ensuring that a user can apply the right domain-specific
proof rule for his or her application while still being able to depend on
the above mentioned reliability guarantees. It is thus the view of the
dissertation author that the expressive framework of a higher-order proof
assistant is crucial to scaling formal verification to realistic
cyber-physical systems, and we hope that the proof rules and associated
applications in this document provide evidence for this claim.

\end{dissertationintroduction}

\chapter{Preliminaries}
\label{chap:prelim}
\input{prelim}

\chapter{}
\label{chap:memo15}
\input{memo15}

\chapter{}
\label{chap:emsoft16}
Chapter~\ref{chap:memo15} introduced two atomic controllers that enforced
desired safety properties when run separately. This raises a natural
question: when can two such controllers be run in parallel in order to
enforce the conjunction of their respective safety properties? More
generally, when can a sampled-data system be built up modularly from
smaller components while ensuring the properties guaranteed by each of the
components. This chapter provides a series of proof rules to address that
question.

\chapter{}
\label{chap:exp-smpl}

%\appendix

% Stuff at the end of the dissertation goes in the back matter
\backmatter
\bibliographystyle{plain} % Or whatever style you want like plainnat
\bibliography{references}

\end{document}
